import os
import json
import speech_recognition as sr
import openai

# Function to load user settings from a JSON file
def load_user_settings():
    settings = {}
    if os.path.exists("user_settings.json"):
        with open("user_settings.json", "r") as file:
            settings = json.load(file)
    return settings

# Function to save user settings to a JSON file
def save_user_settings(settings):
    with open("user_settings.json", "w") as file:
        json.dump(settings, file)

# Function to initialize user settings or prompt the user for them
def initialize_user_settings():
    settings = load_user_settings()

    if "api_key" not in settings:
        api_key = input("Please enter your OpenAI API key: ")
        settings["api_key"] = api_key

    if "activation_word" not in settings:
        activation_word = input("Please enter the activation word: ")
        settings["activation_word"] = activation_word

    save_user_settings(settings)

    return settings

# Initialize user settings
user_settings = initialize_user_settings()
openai.api_key = user_settings["api_key"]
print("""
....................................................................................................
..........................................                   .......................................
.....................................    ..:^!7?JJYYYYYJ?7~^..    ..................................
..................................   :~?5GB#&&&&&&&&&&&&&&&#BPY?~.   ...............................
...............................   :75B&&&&&&&&&&&&&&&&&&&&&&&&&&&B57:   ............................
.............................  :7P#&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&#5!.  ..........................
...........................  ^Y#&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&G?. .........................
.......................... ^5&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&G!  .......................
........................  7#&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&J. ......................
....................... .Y&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&5. .....................
...................... .5&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&Y. ....................
...................... Y&&&&&&&&&&&&&&&&&&&#B#&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&? ....................
..................... 7&&&&&&&&&&&&&&&&&&GJ?7G&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&B: ...................
.................... :B&&&&&&&&&&&&&&&&&&Y777Y&G&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&7 ...................
.................... J&&&&&&&&&&&&B&&&&#BJ777?BY#&&&&&##&&&&&&&&&&&&&&&&&&&&&&&P ...................
................... .B&&&&&&&&&&&#5&&&&P5?7!!7G?G&&&&&PP&GB&&&&&&B&&&&&&&&&&&&&B: ..................
................... ^#&&&&&&&&&&&GJ&&#&577!^~7J7P####&5J#?P&#&&&&JB&&&&&&&&&&&&#^ ..................
................... ~&&&&&&&&&&&&57#BPBPYY?7~!~!?7???J?7J?5PPB#&#JYB#&&&&&&&&&&#^ ..................
................... ^&&&&&&&&&#P#GPGP5YYYYJ?~^^^^^^^^^~^~!!!!77?JY5YPB&&&&&&&&&#^ ..................
................... :#&&&&&&#B5JJ?7!^^^^~!!7!^^^^^^^^^^^^^~!^::::^^~7?#&&&&&&&&B: ..................
.................... P&&&&&&B?777~~!?Y5P5Y?!~^^^^^^^^^^^!7??J55Y?!~:^!B&&&&&&&&P....................
.................... ?&&&&&&#?77~!5YGGBBPP?~^^^^^^^^^^^^~~!7PGBBPGPY~^PB&&&&&&&J ...................
.................... :#&#P#G#Y77^?J:YGBBGP~:^^^^^^^^^^^^^^:~PBBBGY^5J~BBG#&#B#&! ...................
..................... Y&&JJ?J?77~:^~~JYJ?!^^^^^^^^^^^^^^^^^^!?J5Y!~^^~#&#GGB#&B: ...................
..................... :#&#J???77!^^^^^::::^^^^^^^^^^^^^^^^^^:::^^^^^^~#&BBBB&&5 ....................
...................... !B@&GJ7J77~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^!BB#&&#&&7 ....................
....................... :B@@@##G7!^^^^^^^^^^^^^^^!!!!^^^^^^^^^^^^^^^:7#&&&&&G^. ....................
........................ ~&@@@@@G7!^^^^^^^^^^^^^^~77~^^^^^^^^^^^^^^^!B&&&&&&7  .....................
......................... ~#@@@@@BJ!^^^^^^^^^^^^^^~~^^^^^^^^^^^^^:^?#@&&&&&G. ......................
.......................... ~&&@@@@&G?!^^^^^^^^^^^^^^^^^^^^^^^^^:^7P&@@&&&&&! .......................
.......................... .#?5@@@@@&GY7~^^^^^^^^^^^^^^^^^^^^:^7P&@@@@&&&&#: .......................
........................... Y::B#@@&@@@&GJ!~^^^^^^^^^^^^:^^~!Y#@@@&@@@&&&&P.........................
.............................. .:!7~7?YJ?Y???7!~^^^^^^~~!7???5B5G5JB5#&&&&J ........................
............................ ..     .:^~!Y7777???????????777?!.   .. Y&&&&~ ........................
................................. ~P#&@@@#77777777777777777!7BBG5?:  Y&&&B. ........................
...............................  ?&@@@@@@BJ?7777777777777!~^!#@@@@#^ 5&&&Y .........................
.............................. :5@@@@@@@@@@&&##BGP5YJJ?7!!7JG@@@@@@#~G&&&~ .........................
.........................     !#@@@@@@@@@@@@@@@@@@@@@@@&&@@@@@@@@@@@&#&&P...........................
.......................  .^~!P@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&&&~  .........................
....................   :?B&@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&&&57:     ....................
................   .:!Y#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&&@@@#PJ!:.      ..............
..............  :7YG&@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&&@@@@@@@&#G5?!:.  ............
............  ~P&@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&&@@@@@@@@@@@@@@&BY~  ..........
...........  J@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&@@@@@@@@@@@@@@@@@@@Y  .........
.......... .5@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@? .........
.......... J@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#: ........
......... ^&@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@! ........
......... P@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@Y ........
........ !@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@B. .......
........ 5@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&: .......
....... :&@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@! .......
....... ?@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@5 .......
....... JPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPJ........
........                                                                                    ........
....................................................................................................""")
# Function to listen for the activation word and capture the user's command
def listen_and_execute():
    r = sr.Recognizer()

    while True:
        with sr.Microphone() as source:
            print("Listening for the activation word...")
            audio = r.listen(source)

        try:
            activation_word = r.recognize_google(audio)
            if activation_word.lower() == user_settings["activation_word"].lower():
                print("Activation word detected. Please give a command.")
                audio = r.listen(source)
                user_command = r.recognize_google(audio)

                response = openai.Completion.create(
                    model="gpt-4",
                    prompt=user_command,
                    max_tokens=1000
                )

                print("AI Response:", response.choices[0].text)

                # Continue listening for the activation word
                continue
        except sr.UnknownValueError:
            pass
        except sr.RequestError as e:
            print(f"Error: {e}")

if __name__ == "__main__":
    listen_and_execute()
